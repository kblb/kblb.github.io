---
title:      "Writing a trello client"
created_at: 2020-03-09 00:00:00 UTC
author:     Łukasz Biel
layout:     post
original_link: "https://luke-biel.github.io/technology/2020/03/09/a-typescript-course.html"
---
<h4 id="or-how-i-picked-up-typescript">Or how I picked up typescript</h4>

<p>I pick up new projects quite often. To balance the chaos I have numerous <a href="https://trello.com/">trello</a> boards. Each of them represents project or idea that I work on, or intend to work on. To organize them, I’ve created a tool that shows you (from across all of your boards) what tasks have you <strong>In Progress</strong> and some of those that you can pick up from <strong>To Do</strong>.</p>

<h6 id="disclaimer">Disclaimer</h6>

<p>This article is more of a technical walk-through than case study with specific code in mind. If you are interested in viewing <em>how</em> I structured the code, you may visit my <a href="https://luke-biel.github.io/trollo">repo</a>.</p>

<h4 id="why-typescript">Why typescript?</h4>

<p>Other languages I’ve considered were <em>bash</em>, <em>python</em> and <em>ruby</em>. Apart for my personal desire to learn <em>JS</em> and <em>nodejs</em>, <em>TypeScript</em> stood out by being type safe <strong>AND</strong> by providing non-nullability by design. I got used to explicit “null” types when I started writing my applications in <em>Rust</em>.<br />
Additionally <em>TypeScript</em> was supplying me with whole <em>nodejs</em> ecosystem and libraries.</p>

<h4 id="setting-up">Setting up</h4>

<p><em>TypeScript</em> can be seamlessly integrated with <em>npm</em> environment.<br />
First we create new npm package <code class="language-plaintext highlighter-rouge">npm init</code>. This should prompt us with package creator:</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>└─[0] &lt;&gt; npm init
This utility will walk you through creating a package.json file.
It only covers the most common items, and tries to guess sensible defaults.

See `npm help json` for definitive documentation on these fields
and exactly what they do.

Use `npm install &lt;pkg&gt;` afterwards to install a package and
save it as a dependency in the package.json file.

Press ^C at any time to quit.
package name: (test)
version: (1.0.0) 0.1.0
description: A dummy ts package
entry point: (index.js) lib/index.js
test command:
git repository: git@github.com:/luke-biel/test
keywords:
author: Łukasz Biel &lt;lukasz.p.biel@gmail.com&gt;
license: (ISC) MIT
</code></pre></div></div>
<p>Next thing we need to add typescript as a dependency - <code class="language-plaintext highlighter-rouge">npm install typescript @types/node --save-dev</code>. The <code class="language-plaintext highlighter-rouge">@types/node</code> module is necessary for <em>TypeScript</em> to know what function signatures does node export.<br />
We need to add couple of run scripts to <em>package.json</em>, ones that compile code to <em>js</em> and ones that run the app with <em>node</em>.</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"build"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tsc -p ."</span><span class="p">,</span><span class="w">
    </span><span class="nl">"clean"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rm -rf ./lib"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"refresh-pkg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rm -rf ./node_modules ./package-lock.json &amp;&amp; npm install"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"app"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node ./lib/index.js"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p>We add <code class="language-plaintext highlighter-rouge">tsconfig.json</code> so <em>TypeScript</em> compiler knows how to build our code:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"compilerOptions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"target"</span><span class="p">:</span><span class="w"> </span><span class="s2">"es5"</span><span class="p">,</span><span class="w">                  </span><span class="err">//</span><span class="w"> </span><span class="err">target</span><span class="w"> </span><span class="err">es</span><span class="w"> </span><span class="err">backend</span><span class="w">
        </span><span class="nl">"module"</span><span class="p">:</span><span class="w"> </span><span class="s2">"commonjs"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"lib"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"es6"</span><span class="p">,</span><span class="w"> </span><span class="s2">"es2019"</span><span class="p">],</span><span class="w">         </span><span class="err">//</span><span class="w"> </span><span class="err">libraries</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">include</span><span class="w">
        </span><span class="nl">"declaration"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">              </span><span class="err">//</span><span class="w"> </span><span class="err">should</span><span class="w"> </span><span class="err">we</span><span class="w"> </span><span class="err">generate</span><span class="w"> </span><span class="err">.d.ts</span><span class="w"> </span><span class="err">files</span><span class="w">
        </span><span class="nl">"outDir"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lib"</span><span class="p">,</span><span class="w">                  </span><span class="err">//</span><span class="w"> </span><span class="err">where</span><span class="w"> </span><span class="err">we</span><span class="w"> </span><span class="err">want</span><span class="w"> </span><span class="err">.js</span><span class="w"> </span><span class="err">files</span><span class="w"> </span><span class="err">generated</span><span class="w">
        </span><span class="nl">"rootDir"</span><span class="p">:</span><span class="w"> </span><span class="s2">"src"</span><span class="p">,</span><span class="w">                 </span><span class="err">//</span><span class="w"> </span><span class="err">where</span><span class="w"> </span><span class="err">we</span><span class="w"> </span><span class="err">place</span><span class="w"> </span><span class="err">out</span><span class="w"> </span><span class="err">.ts</span><span class="w"> </span><span class="err">code</span><span class="w">
        </span><span class="nl">"strict"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">                   </span><span class="err">//</span><span class="w"> </span><span class="err">we</span><span class="w"> </span><span class="err">want</span><span class="w"> </span><span class="err">strict</span><span class="w"> </span><span class="err">type</span><span class="w"> </span><span class="err">checking</span><span class="w">
        </span><span class="nl">"types"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"node"</span><span class="p">],</span><span class="w">                </span><span class="err">//</span><span class="w"> </span><span class="err">what</span><span class="w"> </span><span class="err">name</span><span class="w"> </span><span class="err">definitions</span><span class="w"> </span><span class="err">should</span><span class="w"> </span><span class="err">we</span><span class="w"> </span><span class="err">include</span><span class="w">
        </span><span class="nl">"esModuleInterop"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">          </span><span class="err">//</span><span class="w"> </span><span class="err">compatibility</span><span class="w"> </span><span class="err">option</span><span class="w">
        </span><span class="nl">"resolveJsonModule"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">         </span><span class="err">//</span><span class="w"> </span><span class="err">include</span><span class="w"> </span><span class="err">modules</span><span class="w"> </span><span class="err">imported</span><span class="w"> </span><span class="err">with</span><span class="w"> </span><span class="err">.json</span><span class="w"> </span><span class="err">extension</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p>With all those things set up, we can create <code class="language-plaintext highlighter-rouge">src/index.ts</code> file:</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Hello, world!</span><span class="dl">"</span><span class="p">);</span>
</code></pre></div></div>
<p>Running it with <code class="language-plaintext highlighter-rouge">npm run build &amp;&amp; npm run app</code> results in:</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>└─[0] &lt;&gt; npm run build &amp;&amp; npm run app

&gt; test@0.1.0 build /home/lbiel/zone/test
&gt; tsc -p .


&gt; test@0.1.0 app /home/lbiel/zone/test
&gt; node ./lib/index.js

Hello, world!
</code></pre></div></div>

<h4 id="integrating-with-trello">Integrating with trello</h4>

<p>Trello provides REST api via url <a href="https://api.trello.com/1">https://api.trello.com/1</a>.</p>

<p>In order to make any request to their service we need their API key and token, first one we get at <a href="https://trello.com/app-key">https://trello.com/app-key</a>, latter at <a href="https://trello.com/1/authorize?expiration=never&amp;scope=read,write,account&amp;response_type=token&amp;name=Server%20Token&amp;key=$TRELLO_KEY">https://trello.com/1/authorize?expiration=never&amp;scope=read,write,account&amp;response_type=token&amp;name=Server%20Token&amp;key=$TRELLO_KEY</a>, where we should replace <strong>$TRELLO_KEY</strong> with our app-key. Further reading is available at <a href="https://developers.trello.com/docs/api-introduction">https://developers.trello.com/docs/api-introduction</a>.</p>

<p>In order to get list of user boards, we need to <strong>GET</strong> <code class="language-plaintext highlighter-rouge">/members/me/boards</code>. We may want to limit json fields to only contain <em>name</em> by adding <code class="language-plaintext highlighter-rouge">?fields=name</code>. <em>id</em> will be added anyway. We won’t use other fields for now. An example of response is:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bts"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5d1dd88d8a013d245d94bf79"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dir-assert"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5e1e1813e86c19040b01120a"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ion-fmt"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5e1afde5d3055a80b84bfe5c"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>I’ve used <em>axios</em> for http client (<code class="language-plaintext highlighter-rouge">npm install axios --save</code>).</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span>
    <span class="nx">$</span><span class="p">{</span><span class="nx">MY_BOARDS_URL</span><span class="p">}?</span><span class="nx">key</span><span class="o">=</span><span class="nx">$</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">apiKey</span><span class="p">}</span><span class="o">&amp;</span><span class="nx">token</span><span class="o">=</span><span class="nx">$</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">apiToken</span><span class="p">}</span><span class="o">&amp;</span><span class="nx">fields</span><span class="o">=</span><span class="nx">name</span><span class="p">,</span><span class="nx">id</span><span class="s2">`
);
</span></code></pre></div></div>
<p>and prepared interface beforehand, to function as a DTO:</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">BoardDTO</span> <span class="p">{</span>
    <span class="nl">name</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>
    <span class="nl">id</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>this is huge benefit of <strong>TypeScript</strong>, we can have typed DTOs as opposed to vague and uncertain data structures that some other languages would provide.</p>

<p>Having board <em>id</em> we can now query each of the boards to get names of lists (columns) available. We do that on endpoint <code class="language-plaintext highlighter-rouge">/boards/$ID/lists</code>. We can again limit ourselves only to download <em>name</em> field. Here’s an excerpt from <em>dir-assert</em> board:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5e1e481819a7f78868014c9e3"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"To Do"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5e1e481c41772d7c02ddf38b"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"In Progress"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5e1e4811276d9c1b3a6f1210"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Done"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>We are only interested with boards that have lists named <strong>To Do</strong> and <strong>In Progress</strong>, so we can filter out other ones.</p>

<p>We need cards from each <strong>To Do</strong> list and each <strong>In Progress</strong> list grouped in one place.
This purpose fulfils <code class="language-plaintext highlighter-rouge">/lists/$ID/cards</code> endpoint. Example response:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5e440f40baa1f3516713b575"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"assert should println! or debug! all paths it went through"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5e440f8939420000a178e545"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"unit test error new_* functions"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5e4410c2c00a4a49e3540929"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cleanup code"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>With all that information collected in DTOs we can now start drawing it!</p>

<h4 id="drawing-on-terminal">Drawing on terminal</h4>

<p>I’ve tested some of the available <a href="https://en.wikipedia.org/wiki/Text-based_user_interface">tui</a>s but none was feeling right, therefore I’ve settled down with plain <em>chalk</em>. <em>chalk</em> is a library that allows you to paint text in easy way, by using template strings.</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">chalk</span><span class="s2">`{red ...there's nothing being worked on currently}`</span>
</code></pre></div></div>

<p>The final result looks like this:</p>

<p><img src="https://luke-biel.github.io/images/2020-03-09-a-typescript-course/usage.png" alt="Trollo" /></p>

<h4 id="conclusion">Conclusion</h4>

<p><a href="https://luke-biel.github.io/trollo">repo</a></p>

<p>I’m quite shocked how easy to use, yet so powerful typescript is. It’s language that I feel quite comfortable writing in, which I haven’t said about anything since the time I started programming in <em>rust</em> and <em>haskell</em>.</p>

<h6 id="about-application">About application</h6>

<p>It works. It even displays useful information, so that’s a success. However…</p>

<p>    …it’s a bit slow. I can use it once a while, but if I’d start each bash session with <a href="https://luke-biel.github.io/trollo">trollo</a> run, as I intended, I’d get annoyed quite quickly for how slow the app is.<br />
Bottleneck is in amount of requests I make. <em>1</em> request for boards, <em>X</em> requests for each boards list, <em>2*X</em> requests for each list cards. So when <em>X is 10</em>, I’m effectively making 31 http requests. That’s a lot.<br />
Well, it’s time to create board for <a href="https://luke-biel.github.io/trollo">trollo</a> and put caching in <strong>To Do</strong> :)</p>